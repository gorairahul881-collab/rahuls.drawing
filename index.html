<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Rahul's Drawing</title>
<style>
  body{margin:0;font-family:Arial,text-align:center;background:#fdf6f0}
  .btn{padding:10px 20px;font-size:1em;background:#ff4757;color:#fff;border:none;border-radius:10px;cursor:pointer;transition:.3s;margin:5px}
  .btn:hover{background:#ff6b81}
  #welcome,#portfolio,#order,#costConfirmation,#finalConfirmation{padding:30px 20px}
  #welcome{height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;background:linear-gradient(to right,#ffecd2,#fcb69f)}
  #welcome h1{font-size:3em;margin:20px 0 10px}
  #portfolio,#order,#costConfirmation,#finalConfirmation{display:none}
  .logo{width:150px;height:150px;border-radius:50%;object-fit:cover;margin:0 auto 10px;border:5px solid #333}

  .gallery{display:flex;flex-wrap:wrap;justify-content:center;gap:20px;margin-bottom:30px}
  .gallery-item{position:relative;display:inline-block;text-align:center}
  .gallery img{width:200px;height:200px;object-fit:cover;border-radius:15px;box-shadow:0 5px 15px rgba(0,0,0,.2);cursor:pointer;transition:.3s;z-index:1;position:relative;-webkit-user-drag:none;user-select:none}
  .gallery img:hover{transform:scale(1.05)}

  #lightbox{display:none;position:fixed;inset:0;background:rgba(0,0,0,.9);justify-content:center;align-items:center;flex-direction:column;z-index:10000}
  #lightbox img{
    max-width:90%;max-height:80%;
    border-radius:15px;box-shadow:0 5px 20px rgba(0,0,0,.5);
    transition:transform 0.15s ease;
    touch-action:none; /* important for custom gestures */
    -webkit-user-drag:none;user-select:none;
    cursor:grab;
    transform-origin:center center;
  }
  #lightbox .close-btn,#lightbox .nav-btn{margin-top:10px;padding:10px 20px;font-size:1em;background:#333;color:#fff;cursor:pointer;border-radius:8px}
  #order input,#order textarea,#order select{padding:10px;margin:5px;width:80%;border-radius:5px;border:1px solid #ccc}
  #uploadPreview{width:200px;height:200px;object-fit:cover;margin-top:10px;border-radius:10px;display:none}
  #orderQueue{text-align:left;max-width:600px;margin:20px auto}
  #orderQueue li{margin:5px 0;background:#fff;padding:5px;border-radius:5px;box-shadow:0 2px 5px rgba(0,0,0,.2)}
  #customerCheck input{padding:5px;width:60%}
</style>
</head>
<body>

<!-- Welcome -->
<div id="welcome">
  <img src="logo.jpg" class="logo" alt="Logo" />
  <h1>Welcome to my page</h1>
  <p>Looking for a perfect gift for yourself or your loved ones? Whether it's for a friend or someone special, you can find something unique here!</p>
  <button class="btn" onclick="showPortfolio()">Visit Page</button>
</div>

<!-- Portfolio -->
<div id="portfolio">
  <img src="logo.jpg" class="logo" alt="Logo" />
  <div class="gallery" id="gallery"></div>
  <button class="btn" onclick="showOrderForm()">Place Your Order</button>

  <h3>Admin Orders Queue</h3>
  <ul id="orderQueue"></ul>

  <h3>Customer Order Check</h3>
  <div id="customerCheck">
    <input type="text" id="checkName" placeholder="Enter your name" />
    <button class="btn" onclick="viewMyOrder()">Check My Order</button>
    <p id="customerOrderList"></p>
  </div>
</div>

<!-- Order -->
<div id="order">
  <h2>Place Your Order</h2>
  <form id="orderForm" onsubmit="submitOrder(event)">
    <input type="text" placeholder="Your Name" id="name" required /><br/>
    <input type="email" placeholder="Email" id="email" required /><br/>
    <select id="countryCode" required></select><br/>
    <input type="text" id="phoneNumber" placeholder="Phone Number" required /><br/>
    <textarea id="details" placeholder="Drawing Details" required></textarea><br/>
    <label>Upload Photo:</label><br/>
    <input type="file" id="uploadPhoto" accept="image/*" onchange="previewImage(event)" /><br/>
    <img id="uploadPreview" /><br/>
    <button type="submit" class="btn">Submit Order</button>
    <button type="button" class="btn" onclick="backToPortfolio()">Back</button>
  </form>
</div>

<!-- Cost Confirmation -->
<div id="costConfirmation">
  <h2>Order Cost</h2>
  <p>Your custom drawing will cost <strong>‚Çπ250</strong>.</p>
  <button class="btn" onclick="confirmOrderFinal()">Confirm Order</button>
  <button class="btn" onclick="backToOrder()">Back</button>
</div>

<!-- Final Confirmation -->
<div id="finalConfirmation">
  <h2>Thank you for your order!</h2>
  <p>Your order has been received! Please wait, I will contact you soon.</p>
  <p>Order Number: <span id="currentOrderNumber"></span></p>
  <button class="btn" onclick="backToPortfolio()">Back</button>
</div>

<!-- Lightbox -->
<div id="lightbox" onclick="closeLightbox(event)">
  <img id="lightbox-img" alt="Lightbox" />
  <div>
    <button class="nav-btn" onclick="prevImage(event)">Previous</button>
    <button class="nav-btn" onclick="zoomIn(event)">üîç Zoom In</button>
    <button class="nav-btn" onclick="zoomOut(event)">üîé Zoom Out</button>
    <button class="nav-btn" onclick="nextImage(event)">Next</button>
    <button class="close-btn" onclick="closeLightbox(event)">Close</button>
  </div>
</div>

<script type="module">
/* -------- Firebase (Likes + Orders) -------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
import { getDatabase, ref, push, onValue, runTransaction } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCIveVNuBXKCs0xKJtVN2do12HnsolTTS8",
  authDomain: "rahul-s-drawing.firebaseapp.com",
  databaseURL: "https://rahul-s-drawing-default-rtdb.firebaseio.com",
  projectId: "rahul-s-drawing",
  storageBucket: "rahul-s-drawing.appspot.com",
  messagingSenderId: "504436503015",
  appId: "1:504436503015:web:98765af24be87807304d42",
  measurementId: "G-7D0642YPJB"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* -------- State -------- */
let orderCount = 0, tempOrderData = null, orders = [];
let galleryImages = [], currentLightboxIndex = 0;

/* -------- Gallery Build -------- */
const gallery = document.getElementById('gallery');
for (let i = 1; i <= 14; i++) {
  galleryImages.push(`drawing${i}.jpg`);
  const div = document.createElement('div');
  div.className = 'gallery-item';
  div.innerHTML = `
    <img src="drawing${i}.jpg" alt="Drawing ${i}" onclick="openLightboxIndex(${i-1})"><br>
    <button class="btn like-btn" onclick="toggleLike('like${i}')">Like (<span id="like${i}">0</span>)</button>
  `;
  gallery.appendChild(div);

  const likeRef = ref(db, "likes/like" + i);
  onValue(likeRef, (snapshot) => {
    document.getElementById("like" + i).innerText = snapshot.val() || 0;
  });
}

/* -------- Country Codes -------- */
const countryCodes = [
  {name:"India", code:"+91"},{name:"USA", code:"+1"},{name:"UK", code:"+44"},
  {name:"Australia", code:"+61"},{name:"Canada", code:"+1"},{name:"Japan", code:"+81"},
  {name:"Germany", code:"+49"},{name:"France", code:"+33"},{name:"China", code:"+86"},
  {name:"Brazil", code:"+55"}
];
const select = document.getElementById("countryCode");
countryCodes.forEach(c => {
  const opt = document.createElement("option");
  opt.value = c.code; opt.textContent = `${c.name} (${c.code})`;
  select.appendChild(opt);
});

/* -------- Navigation -------- */
window.showPortfolio = () => {
  document.getElementById('welcome').style.display = 'none';
  document.getElementById('portfolio').style.display = 'block';
};
window.showOrderForm = () => {
  document.getElementById('portfolio').style.display = 'none';
  document.getElementById('order').style.display = 'block';
};
window.backToPortfolio = () => {
  document.getElementById('finalConfirmation').style.display='none';
  document.getElementById('costConfirmation').style.display='none';
  document.getElementById('order').style.display='none';
  document.getElementById('portfolio').style.display='block';
};
window.backToOrder = () => {
  document.getElementById('costConfirmation').style.display='none';
  document.getElementById('order').style.display='block';
};

/* -------- Lightbox + Zoom/Pan (Desktop + Mobile) -------- */
const lightbox = document.getElementById('lightbox');
const lightboxImg = document.getElementById('lightbox-img');

let zoomLevel = 1;
let isDragging = false;
let startX, startY, moveX = 0, moveY = 0;
let pinchStartDist = 0;
let lastTapTime = 0;

function applyTransform() {
  // translate first, then scale (keeps panning intuitive)
  lightboxImg.style.transform = `translate(${moveX}px, ${moveY}px) scale(${zoomLevel})`;
  lightboxImg.style.cursor = zoomLevel > 1 ? 'grab' : 'default';
}

window.openLightboxIndex = (idx) => {
  currentLightboxIndex = idx;
  lightboxImg.src = galleryImages[idx];
  lightbox.style.display = 'flex';
  // reset state each time
  zoomLevel = 1; moveX = 0; moveY = 0; isDragging = false; pinchStartDist = 0;
  applyTransform();
};
window.prevImage = (e) => {
  e.stopPropagation();
  currentLightboxIndex = (currentLightboxIndex - 1 + galleryImages.length) % galleryImages.length;
  openLightboxIndex(currentLightboxIndex);
};
window.nextImage = (e) => {
  e.stopPropagation();
  currentLightboxIndex = (currentLightboxIndex + 1) % galleryImages.length;
  openLightboxIndex(currentLightboxIndex);
};
window.closeLightbox = (e) => {
  if (e) e.stopPropagation();
  lightbox.style.display = 'none';
  zoomLevel = 1; moveX = 0; moveY = 0; applyTransform();
};

window.zoomIn = (e) => { e.stopPropagation(); zoomLevel = Math.min(5, zoomLevel + 0.2); applyTransform(); };
window.zoomOut = (e) => { e.stopPropagation(); zoomLevel = Math.max(0.5, zoomLevel - 0.2); if (zoomLevel === 1){moveX=0;moveY=0;} applyTransform(); };

/* Mouse wheel zoom */
lightbox.addEventListener('wheel', (e) => {
  e.preventDefault();
  const delta = e.deltaY < 0 ? 0.2 : -0.2;
  const newZoom = Math.min(5, Math.max(0.5, zoomLevel + delta));
  // Optional: keep zoom centered around cursor (basic approach)
  const rect = lightboxImg.getBoundingClientRect();
  const cx = e.clientX - rect.left - rect.width / 2;
  const cy = e.clientY - rect.top - rect.height / 2;
  if (newZoom !== zoomLevel) {
    const scaleFactor = newZoom / zoomLevel;
    moveX = cx - (cx * scaleFactor) + moveX * scaleFactor;
    moveY = cy - (cy * scaleFactor) + moveY * scaleFactor;
    zoomLevel = newZoom;
    applyTransform();
  }
}, { passive: false });

/* Mouse drag */
lightboxImg.addEventListener('mousedown', (e) => {
  if (zoomLevel <= 1) return;
  isDragging = true;
  lightboxImg.style.cursor = 'grabbing';
  startX = e.clientX - moveX;
  startY = e.clientY - moveY;
});
document.addEventListener('mousemove', (e) => {
  if (!isDragging) return;
  moveX = e.clientX - startX;
  moveY = e.clientY - startY;
  applyTransform();
});
document.addEventListener('mouseup', () => {
  isDragging = false;
  if (zoomLevel > 1) lightboxImg.style.cursor = 'grab';
});

/* Touch: single-finger drag + pinch-to-zoom */
lightbox.addEventListener('touchstart', (e) => {
  if (e.touches.length === 1 && zoomLevel > 1) {
    isDragging = true;
    startX = e.touches[0].clientX - moveX;
    startY = e.touches[0].clientY - moveY;
  } else if (e.touches.length === 2) {
    pinchStartDist = getDistance(e.touches[0], e.touches[1]);
  }
}, { passive: false });

lightbox.addEventListener('touchmove', (e) => {
  if (e.touches.length === 1 && isDragging) {
    e.preventDefault();
    moveX = e.touches[0].clientX - startX;
    moveY = e.touches[0].clientY - startY;
    applyTransform();
  } else if (e.touches.length === 2) {
    e.preventDefault();
    const currentDist = getDistance(e.touches[0], e.touches[1]);
    if (pinchStartDist > 0) {
      let scaleChange = currentDist / pinchStartDist;
      let newZoom = zoomLevel * scaleChange;
      newZoom = Math.max(0.5, Math.min(5, newZoom));
      // keep midpoint stable
      const rect = lightboxImg.getBoundingClientRect();
      const midX = (e.touches[0].clientX + e.touches[1].clientX)/2 - rect.left - rect.width/2;
      const midY = (e.touches[0].clientY + e.touches[1].clientY)/2 - rect.top - rect.height/2;
      const scaleFactor = newZoom / zoomLevel;
      moveX = midX - (midX * scaleFactor) + moveX * scaleFactor;
      moveY = midY - (midY * scaleFactor) + moveY * scaleFactor;
      zoomLevel = newZoom;
      applyTransform();
      pinchStartDist = currentDist;
    }
  }
}, { passive: false });

lightbox.addEventListener('touchend', (e) => {
  isDragging = false;
  pinchStartDist = 0;

  /* Double-tap to toggle zoom */
  const currentTime = Date.now();
  if (e.touches.length === 0 && e.changedTouches.length === 1) {
    const tapGap = currentTime - lastTapTime;
    if (tapGap > 0 && tapGap < 300) {
      if (zoomLevel === 1) {
        zoomLevel = 2;
      } else {
        zoomLevel = 1; moveX = 0; moveY = 0;
      }
      applyTransform();
    }
    lastTapTime = currentTime;
  }
});

function getDistance(t1, t2) {
  return Math.hypot(t2.clientX - t1.clientX, t2.clientY - t1.clientY);
}

/* -------- Security (best-effort) -------- */
document.addEventListener("contextmenu", (e) => e.preventDefault());
document.addEventListener("dragstart", (e) => e.preventDefault());
document.addEventListener("keyup", (e) => {
  if (e.key === "PrintScreen") {
    navigator.clipboard.writeText("Screenshots disabled on this site!");
    alert("‚ö†Ô∏è Screenshot is disabled!");
  }
});

/* -------- Likes -------- */
window.toggleLike = async (id) => {
  const likeRef = ref(db, "likes/" + id);
  await runTransaction(likeRef, (currentLikes) => (currentLikes || 0) + 1);
};

/* -------- Preview -------- */
window.previewImage = (event) => {
  const preview = document.getElementById('uploadPreview');
  preview.src = URL.createObjectURL(event.target.files[0]);
  preview.style.display = 'block';
};

/* -------- Order Flow -------- */
window.submitOrder = (event) => {
  event.preventDefault();
  const fileInput = document.getElementById('uploadPhoto');
  let photoFilename = "";
  if (fileInput.files[0]) photoFilename = fileInput.files[0].name.replace(/\s/g, "_");

  tempOrderData = {
    orderNumber: ++orderCount,
    name: document.getElementById('name').value,
    email: document.getElementById('email').value,
    phone: document.getElementById('countryCode').value + ' ' + document.getElementById('phoneNumber').value,
    details: document.getElementById('details').value,
    photoFilename
  };

  document.getElementById('order').style.display = 'none';
  document.getElementById('costConfirmation').style.display = 'block';
};

window.confirmOrderFinal = async () => {
  document.getElementById('costConfirmation').style.display='none';
  document.getElementById('finalConfirmation').style.display='block';
  document.getElementById('currentOrderNumber').innerText = tempOrderData.orderNumber;

  orders.push({ number: tempOrderData.orderNumber, name: tempOrderData.name });
  updateOrderQueue();

  const orderRef = ref(db, "orders");
  await push(orderRef, tempOrderData);

  document.getElementById('orderForm').reset();
  document.getElementById('uploadPreview').style.display='none';
  tempOrderData = null;
};

function updateOrderQueue() {
  const orderQueue = document.getElementById('orderQueue');
  orderQueue.innerHTML = '';
  orders.sort((a,b) => a.number - b.number);
  orders.forEach((order, index) => {
    const li = document.createElement('li');
    li.innerHTML = `#${order.number} - ${order.name} <button class="btn" onclick="confirmDelivery(${index})">Confirm Delivery</button>`;
    orderQueue.appendChild(li);
  });
}
window.confirmDelivery = (index) => { orders.splice(index,1); updateOrderQueue(); };
window.viewMyOrder = () => {
  const inputName = document.getElementById('checkName').value.trim().toLowerCase();
  const myOrders = orders.filter(o => o.name.toLowerCase() === inputName);
  const customerOrderList = document.getElementById('customerOrderList');
  customerOrderList.innerText = myOrders.length ? ('Your Orders: ' + myOrders.map(o=>o.number).join(', ')) : 'No orders found with this name.';
};

</script>
</body>
</html>
